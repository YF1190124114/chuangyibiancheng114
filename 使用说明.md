# 四季树生成器 - 手势控制版说明

本程序在原 L-system 树生长基础上加入了 Teachable Machine 视觉模型：只有在实时识别到 **`pour tea` (倒茶)** 动作时，树木才会继续向上生长。本文总结了运行方式、可调参数以及常见问题，方便你后续调试。

## 运行方式
1. 确保 `model/` 目录内包含 `model.json / metadata.json / weights.bin`（已从 Teachable Machine 导出）。
2. 使用本地服务器打开 `index.html`（如 VSCode Live Server、`npx http-server` 等）。浏览器的 `file://` 模式无法加载模型文件，也无法启用摄像头。
3. 首次运行需允许浏览器访问摄像头。识别画面会显示在页面右侧的「手势识别控制树生长」面板中。

## 手势驱动的生长逻辑
- 视觉模型每帧会给出 `rise glass / pour tea / nothing` 三类预测。
- 只有当预测类别为 `pour tea` 且置信度 ≥ 0.7 时，进度变量 `growthProgress` 才会累加（每次 +0.04）。
- 进度值被映射到 L-system 的迭代层数：进度越高，可发射的层数越多，树木看起来越「生长」。
- 识别为其他动作或置信度不足时，`growthProgress` 立即归零，不会继续解锁新的树枝（已绘制的枝干/叶子保留）。
- 页面上的进度条与 HUD（左上角）会实时显示当前动作与进度百分比。

## 重要参数
在 `sketch.js` 顶部可按需调整：

| 参数 | 默认值 | 作用 |
|------|--------|------|
| `ACTION_THRESHOLD` | `0.7` | 认为是倒茶动作所需的最小置信度 |
| `PROGRESS_STEP` | `0.04` | 每次识别成功时进度增加的幅度，决定解锁速度 |
| `GLOBAL.growPerFrame` | `30` | 每帧绘制多少个线段，影响树枝冒出的速度 |
| `GLOBAL.alongLeafMin/Max` | `2 / 4` | 每条线段沿途铺叶数量范围 |
| `SEASON_CONFIG.*` | — | 各季节的颜色、叶子数量、L-system 迭代次数等 |

若你替换模型或动作标签，请同步修改 `ACTIONS` 常量与 `translateActionLabel()` 中的映射。

## 常见问题
- **摄像头无法启用**：需在 HTTPS 或 localhost 下访问；同时检查浏览器权限。
- **进度条不动**：确认摄像头画面里动作标签是否能识别为 `pour tea`，必要时在 Teachable Machine 中重新训练或调低阈值 `ACTION_THRESHOLD`。
- **树木不生长或生长过快**：调整 `PROGRESS_STEP`、`GLOBAL.growPerFrame` 或季节配置中的 `lsystem.iterations`。

如需进一步扩展（例如改成按键触发生长、或者叠加更多视觉模型），可在 `handleGrowthProgress()` 中加入新的判定逻辑即可。


